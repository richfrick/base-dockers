#!/bin/bash

FROM=${FROM:-"end"}
TOPIC=${TOPIC:-"test"}
GROUP=${GROUP:="rdkafkatestconsumer"}
BROKER=${BROKER:-""}
SASL_USER=${SASL_USER:-""}
SASL_PASS=${SASL_PASS:-""}
MECHANISM=${MECHANISM:-""}
PARTITION=${PARTITION:-"0"}
SECURITY_PROTOCOL=${SECURITY_PROTOCOL:=""}
MESSAGE_COUNT=${MESSAGE_COUNT:=""}
MESSAGE_SIZE=${MESSAGE_SIZE:=""}
MESSAGE_RATE=${MESSAGE_RATE:=$MESSAGE_COUNT}
CONSUMER_WAIT=${CONSUMER_WAIT:="60"}

# Start performance client with specified settings
# "receive.message.max.bytes=200000000"
rdkafka_performance -P \
    -t $TOPIC \
    -c $MESSAGE_COUNT \
    -s $MESSAGE_SIZE \
    -m "0x0A154D73702E526D6D2E456E746974792E436C69656E74125D0A02563112256576656E743A2F2F6D73702E726D6D2E636F72652F3234352F636C69656E742E61646465641A2431653563323539392D366333322D343134622D383765612D363132626334396361346636220A313532353836363232331A3D0A130A0E444F434B45525F544553545F323110C3B5011204313439321A0436373130220D5465737420436C69656E742031320A323031382D30352D3039" \
    -o $FROM \
    -r $MESSAGE_RATE \
    -b $BROKER \
    -X "group.id=$GROUP" \
    -X "sasl.mechanisms=$MECHANISM" \
    -X "security.protocol=$SECURITY_PROTOCOL" \
    -X "sasl.username=$SASL_USER" \
    -X "sasl.password=$SASL_PASS" \
    -X "socket.timeout.ms=30000" \
    -X "socket.keepalive.enable=true" \
    -X "log.connection.close=false" \
    -X "reconnect.backoff.jitter.ms=10000"

